<div class="player">
    <div class="player--scrubber">
      <div class="scrubber--icon"></div>
      <div class="scrubber--mask"></div>
    </div>

    <div class="player--actions">
      <div class="icon-play"></div>
      <div class="icon-pause"></div>
      <div class="icon-previous"></div>
      <div class="icon-next"></div>
    </div>

    <div class="player--info">
      <div class="info--title">{{ title }}</div>
      <div class="info--artist">{{ artist }}</div>
    </div>

    <!--<div class="player--action">
      <div class="action--menu">
          <div class="menu--icon"></div>
          <div class="menu--icon"></div>
          <div class="menu--icon"></div>
      </div>
    </div>-->

</div>

<script>

  console.log(parent.window.root.global.window);

  var sound;

  soundManager.setup({
    url: 'soundmanager/swf/',
    flashVersion: 9,
    preferFlash: true,
  });

  soundManager.onready(function(){

    sound = soundManager.createSound({
      id: 'rtmpPlayer',
      serverURL: '{{serverURL}}',
      url: '{{url}}',
      onconnect: function(bConnect) {
        // this.connected can also be used
        // soundManager._writeDebug(this.id+' connected: '+(bConnect?'true':'false'));
      }
    })

    sound.play({
      whileplaying: function() {
        var scrubber = document.getElementsByClassName('scrubber--mask');
        scrubber[0].style.width = (this.position/this.durationEstimate)*100 + '%' ;
      },
      onfinish: function(){
        // TODO: Check for next track && wipe out scrubber if next()
      }
    });

  });

  function playTrack(){

    sound = soundManager.createSound({
      id: 'rtmpPlayer',
      serverURL: serverURL,
      url: url
    })

    sound.play({
      whileplaying: function() {
        var scrubber = document.getElementsByClassName('scrubber--mask');
        scrubber[0].style.width = (this.position/this.durationEstimate)*100 + '%';
      },
      onfinish: function(){
        // TODO: Check for next track && wipe out scrubber if next()
      }
    });
  }

  var prev = document.getElementsByClassName('icon-previous');
  var next = document.getElementsByClassName('icon-next');
  var pause = document.getElementsByClassName('icon-pause');
  var play = document.getElementsByClassName('icon-play');

  prev[0].onclick = function(){

    console.log("Previous clicked");
    console.log(socket);

    return false;
  };

  next[0].onclick = function(){

    console.log("NEXT clicked");
    return false;

  };

  pause[0].onclick = function(){
      pause[0].style.opacity = 0;
      play[0].style.opacity = 1;
      play[0].style.zIndex = 10;

      sound.pause();
      return false;
  };

  play[0].onclick = function(){
      pause[0].style.opacity = 1;
      play[0].style.opacity = 0;
      play[0].style.zIndex = 0;

      sound.play();
      return false;
  };


</script>
